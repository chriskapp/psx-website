<!DOCTYPE HTML>
<html>
<head>
    <?php include($location . '/inc/meta.html'); ?>
</head>
<body class="psx mdl-color--grey-200 mdl-color-text--grey-700 mdl-base">

<?php include($location . '/inc/header.html'); ?>

<div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">
    <div class="psx-section mdl-color--primary-contrast">
        <h2 class="mdl-typography--display-1-color-contrast">About</h2>
        <p class="mdl-typography--subhead-color-contrast">
            PSX is a framework written in PHP to create <b>REST APIs</b>. 
            It provides tools to handle routing, API versioning, data transformation, 
            authentication, documentation and testing. With PSX you can easily build 
            a REST API around an existing application or create a new one from 
            scratch. Take a look at the <a href="http://example.phpsx.org">example</a> 
            to see an API in action. The following chapter shows some features of 
            PSX which should give you a first impression how it works.
        </p>
    </div>
    <div class="psx-section mdl-color--grey-100">
        <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--6-col">
                <img src="<?php echo $base; ?>/img/api_doc2.png" width="100%" />
            </div>
            <div class="mdl-cell mdl-cell--6-col">
                <h3 class="mdl-typography--title-color-contrast">Documentation</h3>
                <div class="mdl-typography--body-1-color-contrast">
                    <p>PSX provides tools to automatically generate a documentation from 
                    the defined API controllers. The documentation is generated 
                    from the code and is therefore always up to date. To see a 
                    documentation you can view the <b><a href="http://example.phpsx.org/documentation/">example</a></b> 
                    project or take a look at the <b><a href="https://github.com/k42b3/psx-examples">source</a></b>.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="psx-section mdl-color--primary-contrast">
        <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--6-col">
                <h3 class="mdl-typography--title-color-contrast">Schema definition</h3>
                <div class="mdl-typography--body-1-color-contrast">
                    <p>PSX gives you the possibility to define a clear schema for each API 
                    endpoint. The schema can be defined through annotations, as <b><a href="http://raml.org/">RAML</a></b>
                    specification or directly in PHP. Because PSX has all informations how 
                    the API is structured it can validate incoming and outgoing data according 
                    to the schema.</p>

                    <p>Based on the defined schema PSX can also generate different API  
                    definition formats like: <b><a href="http://example.phpsx.org/tool/raml/1/population">RAML</a></b>, 
                    <b><a href="http://example.phpsx.org/tool/swagger/1/population">Swagger</a></b>
                    and <b><a href="http://example.phpsx.org/tool/wsdl/1/population">WSDL</a></b>.
                    These formats can be used i.e. to automatically generate client-side
                    code.</p>
                </div>
            </div>
            <div class="mdl-cell mdl-cell--6-col">
                <div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
                    <div class="mdl-tabs__tab-bar">
                        <a href="#schema-annotation" class="mdl-tabs__tab is-active">Annotation</a>
                        <a href="#schema-raml" class="mdl-tabs__tab">RAML</a>
                        <a href="#schema-php" class="mdl-tabs__tab">PHP</a>
                    </div>
                    <div class="mdl-tabs__panel is-active" id="schema-annotation">
                        <pre><code class="php">class Endpoint extends SchemaApiAbstract
{
    /**
     * Returns a collection of population entries
     *
     * @QueryParam(name="startIndex", type="integer")
     * @QueryParam(name="count", type="integer")
     * @Outgoing(code=200, schema="Acme\Collection")
     */
    public function doGet()
    {
    }

    /**
     * @Incoming(schema="Acme\Entry")
     */
    public function doPost($entry)
    {
    }
}</code></pre>
                    </div>
                    <div class="mdl-tabs__panel" id="schema-raml">
                        <pre><code class="php">class Endpoint extends SchemaApiAbstract
{
    public function getDocumentation()
    {
        return new Raml::fromFile(
            'endpoint.raml', 
            $this-&gt;context-&gt;get(Context::KEY_PATH)
        );
    }
}</code></pre>
                        <pre><code class="yaml">#%RAML 0.8
title: Acme api
baseUri: http://api.acme.com
version: v1
/population:
  description: Returns a collection of population entries
  get:
    queryParameters:
      startIndex:
        type: integer
      count:
        type: integer
    responses:
      200:
        body:
          application/json:
            schema: !include schema/collection.json
  post:
    body:
      application/json:
        schema: !include schema/entry.json
</code></pre>
                    </div>
                    <div class="mdl-tabs__panel" id="schema-php">
                        <pre><code class="php">class Endpoint extends SchemaApiAbstract
{
    public function getDocumentation($version = null)
    {
        $resource = new Resource(
            Resource::STATUS_ACTIVE, 
            $this-&gt;context-&gt;get(Context::KEY_PATH)
        );

        $resource-&gt;setTitle('Acme api');
        $resource-&gt;setDescription('Returns a collection of population entries');

        $resource-&gt;addMethod(Resource\Factory::getMethod('GET')
            -&gt;addQueryParameter(Property::getInteger('startIndex'))
            -&gt;addQueryParameter(Property::getInteger('count'))
            -&gt;addResponse(
                200, 
                $this-&gt;schemaManager-&gt;getSchema('Acme\Schema\Collection')
            )
        );

        $resource-&gt;addMethod(Resource\Factory::getMethod('POST')
            -&gt;setRequest($this-&gt;schemaManager-&gt;getSchema('Acme\Schema\Entry'))
        );

        return $resource;
    }
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="psx-section mdl-color--grey-100">
        <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--6-col">
                <div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
                    <div class="mdl-tabs__tab-bar">
                        <a href="#request-controller" class="mdl-tabs__tab is-active">Controller</a>
                        <a href="#request-model" class="mdl-tabs__tab">Model</a>
                    </div>
                    <div class="mdl-tabs__panel is-active" id="request-controller">
                        <pre><code class="php">class Endpoint extends SchemaApiAbstract
{
    /**
     * @Incoming(schema="Acme\News")
     */
    protected function doPost($news);
    {
        // @TODO do something with the news
        $news-&gt;getTitle();
        $news-&gt;getAuthor()->getName();
        $news-&gt;getContent();

        return array(
            'success' => true,
            'message' => 'Record successful created',
        );
    }
}</code></pre>
                    </div>
                    <div class="mdl-tabs__panel" id="request-model">
                        <pre><code class="php">class News
{
    /**
     * @Type("string")
     * @Description("Title description")
     * @Pattern("[A-z]{3,16}")
     */
    protected $title;

    /**
     * @Type("Acme\Author")
     */
    protected $author;

    /**
     * @Type("string")
     * @MinLength(3)
     * @MaxLength(512)
     * @Required
     */
    protected $content;

    // getter/setter
}
</code></pre>
                    </div>
                </div>
            </div>
            <div class="mdl-cell mdl-cell--6-col">
                <h3 class="mdl-typography--title-color-contrast">Request parsing</h3>
                <div class="mdl-typography--body-1-color-contrast">
                    <p>PSX parses the incoming request into an object graph according to
                    the defined data model. The data model can be defined as simple
                    POPO which can contain annotations to describe the schema.</p>

                    <p>In the example we see an API controller which consumes the request
                    data of a POST request. In the tabs you can see the used data model.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="psx-section mdl-color--primary-contrast">
        <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--6-col">
                <h3 class="mdl-typography--title-color-contrast">Response generation</h3>
                <div class="mdl-typography--body-1-color-contrast">
                    <p>PSX analyzes the data structure of the response and uses a data 
                    writer to generate the response. By default PSX comes with multiple data 
                    writers which can generate different data formats like i.e. JSON or XML. 
                    The writer which gets used depends on the <code>Accept</code> 
                    header field or the GET parameter <code>format</code>. In the example you
                    can see a controller and the corresponding responses from different 
                    data writers.</p>
                </div>
            </div>
            <div class="mdl-cell mdl-cell--6-col">
                <div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
                    <div class="mdl-tabs__tab-bar">
                        <a href="#response-controller" class="mdl-tabs__tab is-active">Controller</a>
                        <a href="#response-json" class="mdl-tabs__tab">JSON</a>
                        <a href="#response-xml" class="mdl-tabs__tab">XML</a>
                        <a href="#response-atom" class="mdl-tabs__tab">Atom</a>
                        <a href="#response-soap" class="mdl-tabs__tab">SOAP</a>
                    </div>
                    <div class="mdl-tabs__panel is-active" id="response-controller">
                        <pre><code class="php">class Endpoint extends SchemaApiAbstract
{
    protected function doGet();
    {
        return [
            'totalResults' => 2,
            'entry' => [[
                'title' => 'Acme news one',
                'content' => 'lorem ipsum'
            ],[
                'title' => 'Acme news two',
                'content' => 'lorem ipsum'
            ]],
        ];
    }
}</code></pre>
                        </div>
                    <div class="mdl-tabs__panel" id="response-json">
                        <pre><code class="json">{
    "totalResults": 2,
    "entry": [
        {
            "title": "Acme news one",
            "content": "lorem ipsum"
        },
        {
            "title": "Acme news two",
            "content": "lorem ipsum"
        }
    ]
}
</code></pre>
                    </div>
                    <div class="mdl-tabs__panel" id="response-xml">
                        <pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;record&gt;
 &lt;totalResults&gt;2&lt;/totalResults&gt;
 &lt;entry&gt;
  &lt;title&gt;Acme news one&lt;/title&gt;
  &lt;content&gt;lorem ipsum&lt;/content&gt;
 &lt;/entry&gt;
 &lt;entry&gt;
  &lt;title&gt;Acme news two&lt;/title&gt;
  &lt;content&gt;lorem ipsum&lt;/content&gt;
 &lt;/entry&gt;
&lt;/record&gt;
</code></pre>
                    </div>
                    <div class="mdl-tabs__panel" id="response-atom">
                        <pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;entry xmlns=&quot;http://www.w3.org/2005/Atom&quot;&gt;
 &lt;content type=&quot;application/xml&quot;&gt;
  &lt;record&gt;
   &lt;totalResults&gt;2&lt;/totalResults&gt;
   &lt;entry&gt;
    &lt;title&gt;Acme news one&lt;/title&gt;
    &lt;content&gt;lorem ipsum&lt;/content&gt;
   &lt;/entry&gt;
   &lt;entry&gt;
    &lt;title&gt;Acme news two&lt;/title&gt;
    &lt;content&gt;lorem ipsum&lt;/content&gt;
   &lt;/entry&gt;
  &lt;/record&gt;
 &lt;/content&gt;
&lt;/entry&gt;
</code></pre>
                    </div>
                    <div class="mdl-tabs__panel" id="response-soap">
                        <pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
 &lt;soap:Body&gt;
  &lt;getResponse xmlns=&quot;http://phpsx.org/2014/data&quot;&gt;
   &lt;totalResults&gt;2&lt;/totalResults&gt;
   &lt;entry&gt;
    &lt;title&gt;Acme news one&lt;/title&gt;
    &lt;content&gt;lorem ipsum&lt;/content&gt;
   &lt;/entry&gt;
   &lt;entry&gt;
    &lt;title&gt;Acme news two&lt;/title&gt;
    &lt;content&gt;lorem ipsum&lt;/content&gt;
   &lt;/entry&gt;
  &lt;/getResponse&gt;
 &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</code></pre>
                    </div>
                    <div class="mdl-tabs__panel" id="response-jsonx">
                        <pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;json:object xmlns:json=&quot;http://www.ibm.com/xmlns/prod/2009/jsonx&quot;&gt;
 &lt;json:number name=&quot;totalResults&quot;&gt;2&lt;/json:number&gt;
 &lt;json:array name=&quot;entry&quot;&gt;
  &lt;json:object&gt;
   &lt;json:string name=&quot;title&quot;&gt;Acme news one&lt;/json:string&gt;
   &lt;json:string name=&quot;content&quot;&gt;lorem ipsum&lt;/json:string&gt;
  &lt;/json:object&gt;
  &lt;json:object&gt;
   &lt;json:string name=&quot;title&quot;&gt;Acme news two&lt;/json:string&gt;
   &lt;json:string name=&quot;content&quot;&gt;lorem ipsum&lt;/json:string&gt;
  &lt;/json:object&gt;
 &lt;/json:array&gt;
&lt;/json:object&gt;
</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="psx-section mdl-color--grey-100">
        <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--6-col">
                <pre>&gt; psx generate spec.raml /acme/news Acme\News
&gt; created directory src/Acme/News
&gt; created file src/Acme/News/Endpoint.php
&gt; created file src/Acme/News/Schema.php
&gt; Generation successful!
</pre>
            </div>
            <div class="mdl-cell mdl-cell--6-col">
                <h3 class="mdl-typography--title-color-contrast">Code generation</h3>
                <div class="mdl-typography--body-1-color-contrast">
                    <p>PSX provides a CLI command to generate controller and 
                    model classes based on a API specification file. These 
                    classes can be used to rapidly develop the defined API 
                    endpoint.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="psx-section mdl-color--primary-contrast">
        <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--6-col">
                <h3 class="mdl-typography--title-color-contrast">API testing</h3>
                <div class="mdl-typography--body-1-color-contrast">
                    <p>Because PSX is build around a HTTP request and response object we 
                    can easily test our API code. We dont need to start a webserver 
                    or mock the request we can simply call our controller from the test. Internally this 
                    is the same code as when we make a call to the webserver except that we 
                    manually create the HTTP request and response.</p>

                    <p>In this way we can easily make an integration test for the API endpoint by 
                    looking at the actual response. In our example we call the GET method
                    of the controller and check whether the response is a JSON object 
                    <code>{"hello": "world"}</code>.</p>
                </div>
            </div>
            <div class="mdl-cell mdl-cell--6-col">
                <pre><code class="php">class HelloWorldApiTest extends ControllerTestCase
{
    public function testHelloWorld()
    {
        // send request to the controller
        $response = $this-&gt;sendRequest('http://127.0.0.1/foo', 'GET');
        $body     = (string) $response->getBody();

        $this-&gt;assertEquals(200, $response->getStatusCode());
        $this-&gt;assertJsonStringEqualsJsonString('{"hello": "world"}', $body);
    }

    protected function getPaths()
    {
        return [
            [['GET'], '/foo', 'Acme\HelloWorldController'],
        ];
    }
}</code></pre>
            </div>
        </div>
    </div>
    <div class="psx-section mdl-color--grey-100">
        <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--6-col">
                <div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
                    <div class="mdl-tabs__tab-bar">
                        <a href="#routing-file" class="mdl-tabs__tab is-active">File</a>
                        <a href="#routing-controller" class="mdl-tabs__tab">Controller</a>
                    </div>
                    <div class="mdl-tabs__panel is-active" id="routing-file">
                        <pre>GET      /news             Acme\News\Application\Index::doIndex
GET      /news/:news_id    Acme\News\Application\Index::doDetail
GET      /bar/$foo&lt;[0-9]+&gt; Acme\News\Application\Article
GET      /download/*file   Acme\News\Application\Download
GET|POST /bar              Acme\News\Application\BarApi</pre>
                    </div>
                    <div class="mdl-tabs__panel" id="routing-controller">
                        <pre><code class="php">class Index extends SchemaApiAbstract
{
    public function doGet()
    {
        $newsId = $this-&gt;getUriFragment('news_id');

        // @TODO work with the news id
    }
}</code></pre>
                    </div>
                </div>
            </div>
            <div class="mdl-cell mdl-cell--6-col">
                <h3 class="mdl-typography--title-color-contrast">Routing</h3>
                <div class="mdl-typography--body-1-color-contrast">
                    <p>PSX uses a simple routing file which was inspired by the Java <a href="https://www.playframework.com/">Play-Framework</a>.
                    We can specify the allowed request methods, the path and the controller which 
                    should be called. In the example controller we access the dynamic part 
                    of the path.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<?php include($location . '/inc/footer.html'); ?>

</body>
</html>
