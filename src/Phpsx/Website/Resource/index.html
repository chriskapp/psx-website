<!DOCTYPE HTML>
<html>
<head>
    <?php include($location . '/inc/meta.html'); ?>
</head>
<body>

<?php include($location . '/inc/header.html'); ?>



<div class="row">
    <div class="col-md-12">
    <br>
    <br>
    <h3 style="text-align:center;">Welcome, PSX is a framework written in PHP which helps you<br>to build
    clean and documented REST APIs.</h3>
    <br>
    <br>
    <br>
    </div>
</div>


<ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#annotation" aria-controls="annotation" role="tab" data-toggle="tab">Annotation</a></li>
    <li role="presentation"><a href="#raml" aria-controls="profile" role="tab" data-toggle="tab">RAML</a></li>
</ul>

<div class="tab-content">
    <!-- ANNOTATION ======================================================== -->
    <div role="tabpanel" class="tab-pane active" id="annotation">

<div class="row">
    <div class="col-md-6">
        <div class="psx-code-box">
            <h4>Controller</h4>
            <pre><code class="php">class Collection extends AnnotationApiAbstract
{
    /**
     * @QueryParam(name="count", type="integer")
     * @Outgoing(code=200, schema="<a href="#" onclick="loadSpec('jsonschema-collection', 'json');return false;">../Resource/schema/collection.json</a>")
     */
    protected function doGet(Version $version)
    {
        $count  = $this-&gt;queryParameters-&gt;getProperty('count') ?: 8;
        $result = $this-&gt;repository-&gt;fetchAll($count);

        return [
            'entry' =&gt; $result
        ];
    }

    /**
     * @Incoming(schema="<a href="#" onclick="loadSpec('jsonschema-entity', 'json');return false;">../Resource/schema/entity.json</a>")
     * @Outgoing(code=201, schema="<a href="#" onclick="loadSpec('jsonschema-message', 'json');return false;">../Resource/schema/message.json</a>")
     */
    protected function doPost(RecordInterface $record, Version $version)
    {
        $this-&gt;repository-&gt;insert('acme_news', [
            'title'      => $record-&gt;getTitle(),
            'content'    => $record-&gt;getContent(),
            'createDate' => new \DateTime(),
        ]);

        return [
            'success' =&gt; true,
            'message' =&gt; 'Create successful',
        ];
    }
}

</code></pre>
        </div>
    </div>
    <div class="col-md-6 hidden-xs hidden-sm">
        <br>
        <br>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            We can use annotations to describe our web service. Because of
            that PSX can automatically validate incoming data and generate a
            <a href="http://example.phpsx.org/documentation/#/api/">documentation</a>
            for the API endpoints.
            <br>
            <br>
            Inside PSX you can use any ORM or database library to fetch the 
            response data.
            <br>
            <br>
            </p>
        </div>
        <br>
        <br>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            We can use the <a href="http://json-schema.org/">JsonSchema</a> format 
            to describe our incoming and outgoing data. PSX comes with an 
            advanced JsonSchema parser which validates the 
            incoming data according to the schema.
            <br>
            <br>
            In our example we use an imagined repository service which
            acts on a database but your are free to use any service you like. 
            All services come from a Symfony compatible DI container.
            <br>
            <br>
            </p>
        </div>
    </div>
</div>

    </div>
    <!-- RAML ============================================================== -->
    <div role="tabpanel" class="tab-pane" id="raml">

<div class="row">
    <div class="col-md-6">
        <div class="psx-code-box">
            <h4>Controller</h4>
            <pre><code class="php">class Collection extends SchemaApiAbstract
{
    public function getDocumentation()
    {
        return Raml::fromFile(
            __DIR__ . '<a href="#" onclick="loadSpec('raml-population', 'yaml');return false;">/../Resource/population.raml</a>', 
            $this-&gt;context-&gt;get(Context::KEY_PATH)
        );
    }

    protected function doGet(Version $version)
    {
        $count  = $this-&gt;queryParameters-&gt;getProperty('count') ?: 8;
        $result = $this-&gt;repository-&gt;fetchAll($count);

        return [
            'entry' =&gt; $result
        ];
    }

    protected function doPost(RecordInterface $record, Version $version)
    {
        $this-&gt;repository-&gt;insert('acme_news', [
            'title'      => $record-&gt;getTitle(),
            'content'    => $record-&gt;getContent(),
            'createDate' => new \DateTime(),
        ]);

        return [
            'success' =&gt; true,
            'message' =&gt; 'Create successful',
        ];
    }
}

</code></pre>
        </div>
    </div>
    <div class="col-md-6 hidden-xs hidden-sm">
        <br>
        <br>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            It is also possible to use a <a href="http://raml.org/">RAML</a> 
            specification to describe you API endpoint. PSX will parse the 
            specification and validates the request accordingly.
            <br>
            <br>
            Besides the <code>getDocumentation</code> method the controller 
            behaves exactly like the annotation controller. In fact the 
            annotation controller has also a <code>getDocumentation</code> 
            implementation which reads the annotations. This architecture gives 
            PSX the flexibility to implement future API specification formats.
            <br>
            <br>
            </p>
        </div>
    </div>
</div>

    </div>
</div>

<div class="psx-body-ruler"></div>

<div class="row">
    <div class="col-md-12">
    <p>This was only a short introduction to give you an insight how a PSX 
    application works. If you are excited about the possibilities as we are you 
    can read the <a href="<?php echo $router->getUrl('Phpsx\Website\Application\About::doIndex'); ?>">about</a>
    page for more informations or checkout the offical <a href="http://psx.readthedocs.org/en/latest/">documentation</a>.</p>
    <br>
    <div style="text-align:center">
        <a href="<?php echo $router->getUrl('Phpsx\Website\Application\Bootstrap::doIndex'); ?>" class="btn btn-primary">Get started</a>
        <a href="<?php echo $router->getUrl('Phpsx\Website\Application\Download::doIndex'); ?>" class="btn btn-default">Download</a>
    </div>
    <br>
    <br>
    </div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Source</h4>
      </div>
      <div class="modal-body">
        <div id="modalSource"></div>
      </div>
    </div>
  </div>
</div>

<?php include($location . '/inc/footer.html'); ?>

<script type="text/javascript">
function loadSpec(id, lang) {
    $('#modalSource').html('<pre class="' + lang + '"><code>' + $('#' + id).html() + '</code></pre>');
    hljs.highlightBlock($('#modalSource pre')[0]);
    $('#myModal').modal({
        show: true
    });
}
</script>

<script type="text/yaml" id="raml-population">#%RAML 0.8
title: Acme API
baseUri: http://acme.com
version: v1
/news:
  get:
    description: Returns a collection of news entries
    queryParameters:
      count:
        type: integer
    responses:
      200:
        body:
          application/json:
            schema: !include schema/collection.json
  post:
    description: Inserts a news entry
    body:
      application/json:
        schema: !include schema/entity.json
    responses:
      201:
        body:
          application/json:
            schema: !include schema/message.json
</script>

<script type="text/json" id="jsonschema-entity">{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "news",
    "description": "News entry",
    "type": "object",
    "properties": {
        "id": {
            "type": "integer",
            "description": "Unique id for each entry"
        },
        "title": {
            "type": "string",
            "description": "Title of the news"
        },
        "content": {
            "type": "string",
            "description": "Main content of the news entry"
        },
        "createDate": {
            "type": "string",
            "format": "date-time",
            "description": "Date when the news was created"
        }
    }
}
</script>

<script type="text/json" id="jsonschema-collection">{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "collection",
    "description": "Collection of news entries",
    "type": "object",
    "properties": {
        "entry": {
            "type": "array",
            "items": {
                "$ref": "file:///entity.json"
            }
        }
    }
}
</script>

<script type="text/json" id="jsonschema-message">{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "message",
    "description": "Response message",
    "type": "object",
    "properties": {
        "success": {
            "type": "boolean",
            "description": "Indicates whether the operation was successful"
        },
        "message": {
            "type": "string",
            "description": "Human readable description what happened"
        }
    }
}
</script>

</body>
</html>
