<!DOCTYPE HTML>
<html>
<head>
    <?php include($location . '/inc/meta.html'); ?>
</head>
<body>

<?php include($location . '/inc/header.html'); ?>

<div class="row">
    <div class="col-md-12">
    <br>
    <br>
    <h3 style="text-align:center;">Welcome, PSX is a framework written in PHP which helps you<br>to build
    clean and documented REST APIs.</h3>
    <br>
    <br>
    <br>
    <br>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="psx-code-box">
            <h4>Controller</h4>
            <pre><code class="php">class Collection extends SchemaApiAbstract
{
    /**
     * @Inject
     * @var \Doctrine\DBAL\Connection
     */
    protected $connection;

    public function getDocumentation()
    {
        return Raml::fromFile(
            __DIR__ . '/../Resource/population.raml', 
            $this-&gt;context-&gt;get(Context::KEY_PATH)
        );
    }

    protected function doGet(Version $version)
    {
        $sql = '  SELECT id, 
                         title, 
                         content, 
                         createDate 
                    FROM acme_news 
                ORDER BY createDate DESC
                   LIMIT :count';

        $count = $this-&gt;queryParameters-&gt;getProperty('count') ?: 8;
        $data  = $this-&gt;connection-&gt;fetchAll($sql, ['count' => $count]);

        return [
            'entry' =&gt; $data
        ];
    }

    protected function doPost(RecordInterface $record, Version $version)
    {
        $this-&gt;connection-&gt;insert('acme_news', [
            'title'      => $record->getTitle(),
            'content'    => $record->getContent(),
            'createDate' => date('Y-m-d H:i:s'),
        ]);

        return [
            'success' =&gt; true,
            'message' =&gt; 'Create successful',
        ];
    }

    protected function doPut(RecordInterface $record, Version $version)
    {
    }

    protected function doDelete(RecordInterface $record, Version $version)
    {
    }
}


</code></pre>
        </div>
    </div>
    <div class="col-md-6 hidden-xs hidden-sm">
        <br>
        <br>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            Specify the dependencies in your controller which come from a 
            Symfony compatible DI container.
            <br>
            <br>
            </p>
        </div>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            Each controller knows the schema of the API endpoint. Because of
            that we can automatically validate incoming data and generate a
            <a href="http://example.phpsx.org/documentation/#/api/">documentation</a>
            for the API endpoints.
            <br>
            <br>
            </p>
        </div>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            Each request method has a seperate method inside the controller. 
            There you can use the services from the DI container to handle the 
            incoming data and produce the response.
            <br>
            <br>
            In our example we use the <a href="https://github.com/doctrine/dbal">Doctrine DBAL</a> 
            library but your are free to choose the DB or ORM library you like.
            PSX will analyze the response and transform it to the fitting format.
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            </p>
        </div>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            The request data is availabe as record which contains all fields 
            which are defined in the request schema.
            <br>
            <br>
            The version object contains the submitted version if the 
            <code>Accept</code> header contains a specific version constraint 
            i.e. <code>application/vnd.acme.v2+json</code>
            <br>
            <br>
            <br>
            <br>
            </p>
        </div>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            If a request method is not available in the schema the API returns
            a <code>405 Method Not Allowed</code> response code with a 
            <code>Allow</code> header containing the available methods.
            <br>
            <br>
            <br>
            </p>
        </div>
    </div>
</div>

<hr>

<div class="row">
    <div class="col-md-6">
        <div class="psx-code-box">
            <h4>RAML Specification</h4>
            <pre><code class="yaml">#%RAML 0.8
title: Acme API
baseUri: http://acme.com
version: v1
/news:
  get:
    description: Returns a collection of news entries
    queryParameters:
      count:
        type: integer
    responses:
      200:
        body:
          application/json:
            schema: !include schema/collection.json
  post:
    description: Inserts a news entry
    body:
      application/json:
        schema: !include schema/entity.json
    responses:
      201:
        body:
          application/json:
            schema: !include schema/message.json
</code></pre>
        </div>
    </div>
    <div class="col-md-6 hidden-xs hidden-sm">
        <br>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            The API schema can be described in the <a href="http://raml.org/">RAML</a> 
            format. PSX reads the specification from the path and validates the 
            request data according to the schema.
            <br>
            <br>
            </p>
        </div>
        <br>
        <br>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            It is possible to include <a href="http://json-schema.org/">JSON schema</a> 
            specifications which describe the request and response body.
            <br>
            <br>
            </p>
        </div>
    </div>
</div>

<hr>

<div class="row">
    <div class="col-md-6">
        <div class="psx-code-box">
            <h4>JSON Schema entity.json</h4>
            <pre><code class="json">{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "news",
    "description": "News entry",
    "type": "object",
    "properties": {
        "id": {
            "type": "integer",
            "description": "Unique id for each entry"
        },
        "title": {
            "type": "string",
            "description": "Title of the news"
        },
        "content": {
            "type": "string",
            "description": "Main content of the news entry"
        },
        "createDate": {
            "type": "string",
            "format": "date-time",
            "description": "Date when the news was created"
        }
    }
}

</code></pre>
        </div>

        <div class="psx-code-box">
            <h4>JSON Schema collection.json</h4>
            <pre><code class="json">{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "collection",
    "description": "Collection of news entries",
    "type": "object",
    "properties": {
        "entry": {
            "type": "array",
            "items": {
                "$ref": "file:///entity.json"
            }
        }
    }
}

</code></pre>
        </div>

    </div>
    <div class="col-md-6 hidden-xs hidden-sm">
        <br>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            It is great to have a framework independent format which describes
            your data. Since JSON schema is the defacto standard for describing 
            JSON data you probably already have a schema wich you can utilize 
            with PSX. If not it is a great way to start defining a schema.
            <br>
            <br>
            </p>
        </div>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <div class="psx-annotation">
            <p>
            <br>
            PSX provides an advanced JSON schema parser which can handle local  
            and remote schema referenes.
            <br>
            <br>
            </p>
        </div>
    </div>
</div>




<?php include($location . '/inc/footer.html'); ?>

</body>
</html>
